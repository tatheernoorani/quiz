function selectQuiz(_){var a=jQuery;a("#fca_qc_quiz_settings_meta_box, #fca_qc_social_sharing_meta_box, #fca_qc_email_optin_meta_box, #fca_qc_quiz_appearance_meta_box, #fca_qc_startbtn_appearance_meta_box, #fca_qc_answers_appearance_meta_box, #fca_qc_rwpanel_appearance_meta_box, #fca_qc_custom_css_meta_box").hide(),a("#fca_qc_description_meta_box, #fca_qc_quiz_type_meta_box").show(),"mc"===_&&(a("#fca_qc_quiz_type").val(_),a("#fca_qc_quiz_type_meta_box").hide(),a("#fca_qc_add_personality_result_meta_box, #fca_qc_personality_questions_meta_box").hide(),a("#fca_qc_answer_mode_tr").show(),a("#fca_qc_questions_meta_box, #fca_qc_add_result_meta_box").show(),a("#fca_qc_hints_toggle_tr").show(),a("#fca_qc_weighted_questions_meta_box, #fca_qc_add_weighted_result_meta_box").hide()),"pt"===_&&(a("#fca_qc_quiz_type").val(_),a("#fca_qc_quiz_type_meta_box").hide(),a("#fca_qc_questions_meta_box, #fca_qc_add_result_meta_box").hide(),a("#fca_qc_answer_mode_tr").hide(),a("#fca_qc_add_personality_result_meta_box, #fca_qc_personality_questions_meta_box").show(),a("#fca_qc_hints_toggle_tr").hide(),a("#fca_qc_weighted_questions_meta_box, #fca_qc_add_weighted_result_meta_box").hide()),"wq"===_&&(a("#fca_qc_quiz_type").val(_),a("#fca_qc_quiz_type_meta_box").hide(),a("#fca_qc_add_personality_result_meta_box, #fca_qc_personality_questions_meta_box").hide(),a("#fca_qc_questions_meta_box, #fca_qc_add_result_meta_box").hide(),a("#fca_qc_answer_mode_tr").hide(),a("#fca_qc_hints_toggle_tr").hide(),a("#fca_qc_weighted_questions_meta_box, #fca_qc_add_weighted_result_meta_box").show())}function attach_add_answer_button_handlers_free(){var _=jQuery;_(".fca_qc_add_answer_btn").unbind("click"),_(".fca_qc_add_answer_btn").click(function(){var a=parseInt(_(this).siblings(".fca_qc_answer_input_div").length+1),e=parseInt(_(this).closest(".fca_qc_question_item").attr("id").replace(/[^0-9.]/g,"")),t=fcaQcAdminData.answerDiv.replace(/{{ANSWER_NUMBER}}/g,a);t=(t=t.replace(/{{QUESTION_NUMBER}}/g,e)).replace(/{{ID}}/g,fca_qc_new_GUID()),_(this).before(t),attach_delete_button_handlers(),attach_image_upload_handlers()})}function attach_delete_button_handlers(){var _=jQuery;_(".fca_qc_delete_icon").unbind("click"),_(".fca_qc_delete_icon_confirm").click(function(){_(this).closest("."+_(this).data("target")).remove(),_(this.parentNode).hasClass("fca_qc_personality_result_item")?add_result_personality_result_text_handlers():setScoreRanges()}),_(".fca_qc_delete_icon_cancel").click(function(){_(this).hide().siblings(".fca_qc_delete_icon").hide(),_(this).siblings(".fca_qc_delete_button").show()}),_(".fca_qc_delete_button").click(function(){_(this).siblings(".fca_qc_delete_icon").show(),_(this).hide()})}function add_result_heading_text_handlers(){var _=jQuery;_(".fca_qc_quiz_result").unbind("keyup"),_(".fca_qc_quiz_result").keyup(function(){_(this).closest(".fca_qc_result_input_div").siblings(".fca_qc_result_label").children(".fca_qc_result_score_title").html(_(this).val())}),setScoreRanges()}function add_question_heading_text_handlers(){var _=jQuery;_(".fca_qc_question_text").unbind("keyup"),_(".fca_qc_question_text").keyup(function(){_(this).closest(".fca_qc_question_input_div").prev().children(".fca_qc_quiz_heading_text").html(_(this).val())})}function add_question_and_result_click_toggles(){var _=jQuery;_(".fca_qc_question_item, .fca_qc_result_item").unbind("click"),_(".fca_qc_question_item").click(function(a){var e=_(a.target).hasClass("fca_qc_delete_icon");!1!==dragCheck||e||(_(".fca_qc_question_input_div").not(_(this).find(".fca_qc_question_input_div")).hide(),_(this).find(".fca_qc_question_input_div").toggle("fast"))}),_(".fca_qc_result_item").click(function(a){var e=_(a.target).hasClass("fca_qc_delete_icon");!1!==dragCheck||e||(_(".fca_qc_result_input_div").not(_(this).find(".fca_qc_result_input_div")).hide(),_(this).find(".fca_qc_result_input_div").toggle("fast"))}),_(".fca_qc_question_input_div, .fca_qc_result_input_div, .fca_qc_delete_icon").bind("click",function(_){_.stopPropagation()})}function fca_qc_save_question_json(_){var a=jQuery;a("#editor-nav").click();var e=[],t=a(".fca_qc_question_item:visible");a(t).each(function(){correctAnswer=1,answer=1,a(this).find(".fca_qc_answer_input_div").each(function(){if("Correct Answer"===a(this).find(".fca_qc_answer_header").text()){correctAnswer=answer;fcaQcAdminData.answerDiv.replace(/{{CORRECT_ANSWER}}/g,correctAnswer)}answer+=1});var _=[];a(this).find(".fca_qc_answer_input_div").each(function(){_.push({answer:a(this).find(".fca_qc_question_texta").val(),img:a(this).find(".fca_qc_image_input").val(),id:a(this).find(".fca_qc_id").val(),points:a(this).find(".fca_qc_weighted_question_points").val(),hint:a(this).find(".fca_qc_hint_tr .fca_qc_question_texta").val(),results:a(this).find(".fca_qc_multiselect").val()})}),e.push({question:a(this).find(".fca_qc_question_text").val(),img:a(this).find(".fca_qc_image_input").val(),correct:correctAnswer,id:a(this).find(".fca_qc_id").val(),answers:_})}),a("#fca_qc_questions_json").val(JSON.stringify(e))}function fca_qc_save_result_json(_){var a=jQuery,e=[];a(".fca_qc_result_item:visible").each(function(){e.push({title:a(this).find(".fca_qc_quiz_result").val(),desc:a(this).find(".fca-wysiwyg-html").val(),img:a(this).find(".fca_qc_image").attr("src"),min:a(this).find(".fca_qc_result_min").val(),max:a(this).find(".fca_qc_result_max").val(),url:a(this).find(".fca_qc_url_input").val(),tags:a(this).find(".fca_qc_results_tags").val(),groups:a(this).find(".fca_qc_mailchimp_groups").val(),id:a(this).find(".fca_qc_id").val()})}),a("#fca_qc_results_json").val(JSON.stringify(e))}function setScoreRanges(){var _=jQuery,a=_(".fca_qc_question_item:visible").length,e=_(".fca_qc_result_item:visible").length;if("wq"===_("#fca_qc_quiz_type").val()){var t=[];_(".fca_qc_question_item:visible").each(function(){var a=0;_(this).find(".fca_qc_weighted_question_points").each(function(){Number(_(this).val())>a&&(a=_(this).val())}),t.push(a)}),a=t.reduce(function(_,a){return Number(_)+Number(a)})}var c=a%e;_(".fca_qc_result_item:visible").each(function(t,i){var s=0;if(t>0&&(s=1+Number(_(i).prev().find(".fca_qc_result_max").val())),c)if(t<=c)n=s+Math.floor(a/e);else n=s-1+Math.floor(a/e);else var n=(t+1)*Math.floor(a/e);_(i).find(".fca_qc_result_min").val(s),_(i).find(".fca_qc_result_max").val(n);var o=s+"-"+n+" "+fcaQcAdminData.points_string+": ";s===n&&(o=s+" "+fcaQcAdminData.points_string+": "),s>n&&(o=fcaQcAdminData.unused_string),_(i).find(".fca_qc_result_score_value").html(o)})}function setQuestionNumbers(_){var a=jQuery,e=1;_.find(".fca_qc_question_item").each(function(){a(this).find(".fca_qc_quiz_heading_question_number").html(fcaQcAdminData.question_string+" "+e+": "),e+=1})}function attach_image_upload_handlers(){var _=jQuery;_(".fca_qc_quiz_image_upload_btn, .fca_qc_image, .fca_qc_quiz_image_change_btn").unbind("click"),_(".fca_qc_quiz_image_upload_btn, .fca_qc_image, .fca_qc_quiz_image_change_btn").click(function(a){a.preventDefault();var e=_(this);_(this).hasClass("fca_qc_quiz_image_change_btn")?e=_(this.parentNode).siblings(".fca_qc_quiz_image_upload_btn"):_(this).hasClass("fca_qc_image")&&(e=_(this).siblings(".fca_qc_quiz_image_upload_btn"));var t=wp.media({frame:"post",title:fcaQcAdminData.selectImage_string,multiple:!1}).open().on("insert",function(){var _=t.state().get("selection").first(),a=t.state().display(_).toJSON(),c=(_=_.toJSON()).sizes[a.size].url;c&&(e.siblings(".fca_qc_image_input").attr("value",c),e.siblings(".fca_qc_image").attr("src",c),e.siblings(".fca_qc_image_hover_controls").find(".fca_qc_quiz_image_change_btn").show(),e.siblings(".fca_qc_image_hover_controls").find(".fca_qc_quiz_image_revert_btn").show()),e.hide()})}),_(".fca_qc_quiz_image_revert_btn").unbind("click"),_(".fca_qc_quiz_image_revert_btn").click(function(a){_(this.parentNode).siblings(".fca_qc_image_input").attr("value",""),_(this.parentNode).siblings(".fca_qc_image").attr("src",""),_(this.parentNode).siblings(".fca_qc_quiz_image_upload_btn").show(),_(this).hide(),_(this).siblings(".fca_qc_quiz_image_upload_btn").hide()})}function add_drag_and_drop_sort(){var _=jQuery;_(".fca_qc_sortable_results, .fca_qc_sortable_questions, .fca_qc_question_input_div").sortable({revert:!0,cancel:":input,button, .fca-wysiwyg-html",start:function(){dragCheck=!0},stop:function(){dragCheck=!1,fca_attach_wysiwyg()}}),_(".fca_qc_sortable_results").unbind("sortupdate"),_(".fca_qc_sortable_results").on("sortupdate",function(_,a){setScoreRanges()}),_(".fca_qc_sortable_questions").unbind("sortupdate"),_(".fca_qc_sortable_questions").on("sortupdate",function(a,e){setQuestionNumbers(_(this))})}function fca_qc_new_GUID(){var _=4294967296*Math.random()>>>0,a=4294967296*Math.random()>>>0,e=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0;return fca_qc_hash_seed[255&_]+fca_qc_hash_seed[_>>8&255]+fca_qc_hash_seed[_>>16&255]+fca_qc_hash_seed[_>>24&255]+"-"+fca_qc_hash_seed[255&a]+fca_qc_hash_seed[a>>8&255]+"-"+fca_qc_hash_seed[a>>16&15|64]+fca_qc_hash_seed[a>>24&255]+"-"+fca_qc_hash_seed[63&e|128]+fca_qc_hash_seed[e>>8&255]+"-"+fca_qc_hash_seed[e>>16&255]+fca_qc_hash_seed[e>>24&255]+fca_qc_hash_seed[255&t]+fca_qc_hash_seed[t>>8&255]+fca_qc_hash_seed[t>>16&255]+fca_qc_hash_seed[t>>24&255]}function fca_qc_attach_radio_selects(){var _=jQuery;_(".qc_radio_input").change(function(){_(this).closest(".radio-toggle").children("label").removeClass("selected"),_(this).closest("label").addClass("selected")})}jQuery(document).ready(function(_){_(".meta-box-sortables").sortable({disabled:!0}),_(".postbox .hndle").css("cursor","pointer"),fca_qc_attach_radio_selects(),_(".fca_qc_custom_css").length>0&&wp.codeEditor.initialize(_(".fca_qc_custom_css"),fcaQcAdminData.code_editor);var a=_(".fca_qc_question_item").length,e=_(".fca_qc_result_item ").length;""===_("#post_name").val()&&_("#post_name").val(_("#post_ID").val()),0===_("#fca_qc_quiz_type_meta_box").length&&_("#fca_qc_questions_meta_box, #fca_qc_add_result_meta_box").show(),_(".onoffswitch-inner").each(function(){_(this).attr("data-content-on",fcaQcAdminData.on_string),_(this).attr("data-content-off",fcaQcAdminData.off_string)}),_(".fca_qc_question_input_div").length>1&&_(".fca_qc_question_input_div").hide(),_(".fca_qc_result_input_div").length>1&&_(".fca_qc_result_input_div").hide();var t='<button type="submit" class="button-primary" id="fca_qc_submit_button">'+fcaQcAdminData.save_string+"</buttton>",c='<button type="button" class="button-secondary" id="fca_qc_preview_button">'+fcaQcAdminData.preview_string+"</buttton>";_("#normal-sortables").append(t);var i=!0;_("input, select").on("input, change",function(){window.onbeforeunload=function(){return i}}),_("#fca_qc_submit_button").click(function(a){i=null;_(this).closest("form").removeAttr("target"),_("#fca_qc_quiz_preview_url").val("")}),_("#post").submit(function(a){fca_qc_save_question_json(_("#post")),fca_qc_save_result_json(_("#post"))}),_("#normal-sortables").append(c),_("#fca_qc_preview_button").click(function(a){a.preventDefault();var e=_(this).closest("form");e.prop("target","_blank"),fca_qc_save_question_json(e),fca_qc_save_result_json(e),e.submit()}),_("#submitdiv").hide(),_(".fca_qc_image").each(function(a){""!==_(this).attr("src")&&_(this).siblings(".fca_qc_quiz_image_upload_btn").hide()}),jQuery.widget.bridge("jQueryUITooltipFCAQC",jQuery.ui.tooltip),_(".fca_qc_tooltip").jQueryUITooltipFCAQC({position:{my:"left",at:"right+2"}}),_("#wpbody-content").show(),_("#fca-quiz-select-multiplechoice").click(function(_){selectQuiz("mc"),setScoreRanges()}),_("#fca-quiz-select-personality").click(function(_){selectQuiz("pt"),setScoreRanges()}),_("#fca-quiz-select-weighted").click(function(_){selectQuiz("wq"),setScoreRanges()}),_("#editor-nav").click(),_("#editor-nav").click(function(){_(".nav-tab-active").removeClass("nav-tab-active"),_(this).addClass("nav-tab-active").blur(),selectQuiz(_("#fca_qc_quiz_type").val())}).click(),_("#settings-nav").click(function(){_(".nav-tab-active").removeClass("nav-tab-active"),_(this).addClass("nav-tab-active").blur(),_("#fca_qc_description_meta_box, #fca_qc_weighted_questions_meta_box, #fca_qc_add_weighted_result_meta_box, #fca_qc_questions_meta_box, #fca_qc_add_result_meta_box, #fca_qc_personality_questions_meta_box, #fca_qc_add_personality_result_meta_box, #fca_qc_quiz_appearance_meta_box, #fca_qc_startbtn_appearance_meta_box, #fca_qc_answers_appearance_meta_box, #fca_qc_rwpanel_appearance_meta_box, #fca_qc_custom_css_meta_box").hide(),_("#fca_qc_quiz_settings_meta_box, #fca_qc_social_sharing_meta_box, #fca_qc_email_optin_meta_box").show()}),_("#appearance-nav").click(function(){_(".nav-tab-active").removeClass("nav-tab-active"),_(this).addClass("nav-tab-active").blur(),_("#fca_qc_description_meta_box, #fca_qc_weighted_questions_meta_box, #fca_qc_add_weighted_result_meta_box, #fca_qc_questions_meta_box, #fca_qc_add_result_meta_box, #fca_qc_personality_questions_meta_box, #fca_qc_add_personality_result_meta_box, #fca_qc_quiz_settings_meta_box, #fca_qc_social_sharing_meta_box, #fca_qc_email_optin_meta_box").hide(),_("#fca_qc_quiz_appearance_meta_box, #fca_qc_startbtn_appearance_meta_box, #fca_qc_answers_appearance_meta_box, #fca_qc_rwpanel_appearance_meta_box, #fca_qc_custom_css_meta_box").show(),"mc"===_("#fca_qc_quiz_type").val()?_(".fca_qc_hide_answers_input").each(function(){_(this).prop("checked")&&"hide"===_(this).val()?_("#fca_qc_rwpanel_appearance_meta_box").hide():_("#fca_qc_rwpanel_appearance_meta_box").show()}):_("#fca_qc_rwpanel_appearance_meta_box").hide()}),_("#fca_qc_add_question_btn").click(function(){a+=1,_(".fca_qc_question_input_div").hide();for(var e=fcaQcAdminData.questionDiv.replace(/{{QUESTION_NUMBER}}/g,a);-1!==e.indexOf("{{ID}}");)e=e.replace(/{{ID}}/,fca_qc_new_GUID());_(this).siblings(".fca_qc_sortable_questions").append(e),add_drag_and_drop_sort(),add_question_heading_text_handlers(),add_question_and_result_click_toggles(),attach_delete_button_handlers(),attach_image_upload_handlers(),attach_add_answer_button_handlers_free(),setScoreRanges(),setQuestionNumbers(_(this).siblings(".fca_qc_sortable_questions")),_("#fca_qc_explanations").change()}),_("#fca_qc_add_result_btn").click(function(){e+=1,_(".fca_qc_result_input_div").hide();var a=fcaQcAdminData.resultDiv.replace(/{{RESULT_NUMBER}}/g,e);a=a.replace(/{{ID}}/g,fca_qc_new_GUID()),_(this).siblings(".fca_qc_sortable_results").append(a),add_drag_and_drop_sort(),add_question_and_result_click_toggles(),attach_delete_button_handlers(),attach_image_upload_handlers(),add_result_heading_text_handlers(),setScoreRanges(),fca_attach_wysiwyg()}),_(".fca_qc_shortcode_input").click(function(_){this.select()}),_("#fca_qc_shortcode_label").click(function(a){_(".fca_qc_shortcode_input").select()}),_(".fca_qc_admin_label").click(function(a){_(this).next().focus()}),add_drag_and_drop_sort(),add_question_and_result_click_toggles(),add_question_heading_text_handlers(),add_result_heading_text_handlers(),attach_delete_button_handlers(),attach_add_answer_button_handlers_free(),setScoreRanges(),attach_image_upload_handlers()});for(var dragCheck=!1,fca_qc_hash_seed=[],i=0;i<256;i++)fca_qc_hash_seed[i]=(i<16?"0":"")+i.toString(16);